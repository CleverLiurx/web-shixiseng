# UPD与TCP协议是什么，有哪些区别？

> TCP 和 UDP都是传输层协议

## UDP

UDP的全称是**用户数据报协议**，在网络中它与TCP协议一样用于处理数据包，是一种无连接的协议。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe5d7ab7e17e420a82e6ec7db5baec9a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

### UDP首部

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fde395e8f304135aea6a19b6239bafc~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

- `端口号`：标记的是`使用网络的进程`（源端口号就是原机器正在使用网络的进程，目的端口号就是目的机器正在使用网络的进程）
- `16位UDP长度`：指的就是UDP数据报的长度（该长度包括UDP数据）
- `16位UDP校验和`：检测UDP的用户数据报在传输中是否出错
- `UDP数据`：实际要发的数据

### 特点

#### UDP是一个无连接的协议

比如A和B进行电话通信，在通信之前，需要先拿出电话，然后拨号，这个是建立连接的过程。当电话拨通之后，说明连接已经建立起来了，此时就可以进行通信了。当通信之后，就将电话挂断，这个相当于结束连接。这个过程就是 **`有连接`** 的过程。而UDP是无连接的，也就是说，他在通信之前，不需要先建立连接，只要在想发数据的时候，直接就将数据发送出去了

#### UDP不能保证可靠的交付数据

首先UDP是无连接的协议，在发送数据的时候想发就发，无法保证数据在网络中是否有丢失，即使有丢失，它也不会感知到从前边的UDP头部也可以看出来，它的头部非常简单，并没有提供任何的机制来保证数据可以可靠的传给对方

#### UDP是面向报文传输的

UDP对应用层传输的数据并不会进行任何的处理，直接塞进UDP协议的数据中

#### UDP没有拥塞控制

如果把网络看做是一条公路，如果车辆特别多，就会导致拥塞。UDP并不会感知网络是否拥塞，不管是否拥塞，它都会尽量的把数据给发送出去

#### UDP的首部开销非常小

从上边的UDP首部图可以看出来，总共也就8个字节

## TCP

TCP的全称是`传输控制协议`，是一种面向连接的、可靠的、基于字节流的传输层通信协议。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43c1d89d38fd41588fe439d634999b33~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

### TCP首部

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8ff34fabbbb41bcb7b05f41a5339a20~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

- 16位的源端口和目的端口是和UDP中的一样的
- 序号：序号一共占用32个比特位，所以它可以表示的范围是0~2^32。因为TCP协议是面向字节流的，因此，每一个字节都有一个唯一的序号，这个序号就是用来标记传输的每一个字节的（一个字节一个序号）。这里的序号所代表的就是，这个TCP报文所传输的数据的第一个字节序号是什么
- 确认号：确认号所表示的范围也是0~2^32，也是一个字节一个确认号。确认号表示的就是期待收到数据的首字节序号是什么 假设有一个TCP数据报，它的序号是501，数据的长度是100个字节。某个计算机收到了这个数据，确认号就会说，501到600这个范围的数据，我都已经收到了，然后期望下一个传递给我的数据的确认号是601。所以确认号表示的就是，我期望下一个数据报里数据的首字节序号。确认号是配合序号一起来使用的。 如果某一个TCP数据报的数据确认号是N，则表示N-1序号的数据都已经收到 

  ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d0f4e3e58654f4986551e214a0f5cf9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

- 数据偏移： 占4个比特位（015），单位是32位字，也就是说，每一个偏移都可以表示4个字节的偏移 它表示的就是真实的TCP数据，它偏离首部的距离（这个主要是由于TCP选项这个块的内容所导致的，因为我们并不知道这个选项的内容有多少，所以需要存储数据偏移） TCP头部有固定长度的20个字节（至少），那TCP首部最长有多少个字节？ 此时可以对数据偏移进行一个简单的计算，以得到TCP首部最长有多少 因为数据偏移最大表示的是15，每一个偏移都可以表示4个字节。所以最大偏移是15乘4等于60字节，所以TCP首部的长度范围就是2060字节
- 保留字段：保留着的，还没有使用的
- TCP标记：占6个比特位，每位都有不同的含义，他们分别是：

  ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98ba7cdaffb34cc382b067f6c7aac81a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

- 窗口：占16个比特位，02^16-1。窗口的意思就是，指明允许对方发送的数据量。如果窗口大小为1000，则表明对方可以发送1000个字节 也可以结合窗口和确认号进行一个运算，假设确认号为501，窗口的值为1000，也就是说5011500之间字节的数据是可以接收的
- 校验和：和UDP里边的校验和意思是一样的，可以看一下我上一篇介绍UDP的文章
- 紧急指针：这个只有当前边TCP标记位的URG=1时才启用，它表示紧急数据位于报文的位置。对于TCP报文来说，是有部分的紧急数据可以保存在数据报中的，等对方接收到的时候，就可以通过紧急指针来找到紧急数据所位于数据报的位置
- TCP选项：它是可选的，从前边通过对数据偏移的计算可以知道，TCP选项最多有40个字节。这个选项主要是为了支持协议未来的发展所使用的（支持未来的拓展）

### 特点

#### TCP是面向连接的协议

在上面UDP协议详解中有对面向连接进行了介绍，也就是在通信之前会先建立连接（通过三次握手）

#### 一个TCP的连接有两端（点对点通信）

每条TCP传输连接只能有两个端点，只能进行点对点的数据传输，不支持多播和广播传输方式

#### TCP提供可靠的传输服务

通过确认号、校验和等首部字段，可以保证数据的可靠传输

#### TCP协议提供全双工的通信

全双工在网络概览中有提到，指的就是一条通信线路，双方都可以同时发送和接收消息。也就是说，如果两台计算机建立了TCP连接，那么这两台计算机都可以同时向连接中发送数据或接收数据

#### TCP是面向字节流的协议

TCP不像UDP一样那样一个个报文独立地传输，而是在不保留报文边界的情况下以字节流方式进行传输。

## 总结
|              | UDP                                        | TCP                                                  |
| ------------ | ------------------------------------------ | ---------------------------------------------------- |
| 是否连接     | 无连接                                     | 面向连接                                             |
| 是否可靠     | 不可靠传输，不使用流量控制和拥塞控制       | 可靠传输（数据顺序和正确性），使用流量控制和拥塞控制 |
| 连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信 | 只能是一对一通信                                     |
| 传输方式     | 面向报文                                   | 面向字节流                                           |
| 首部开销     | 首部开销小，仅8字节                        | 首部最小20字节，最大60字节                           |
| 适用场景     | 适用于实时应用，例如视频会议、直播         | 适用于要求可靠传输的应用，例如文件传输               |

